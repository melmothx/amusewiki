This file documents the revision history for AmuseWiki.

WARNING: *NEVER* run the test suite in the production tree, as will
leave stray logs and files. If you want to run 'make test', do it in a
dedicated tree.

2.518 2021-08-03

 - Fix theme-switcher persistence for non-logged in (reported by
   anelki on the #amusewiki channel)

2.517 2021-08-02

 - Fix crash on debian package when temporary process is gone
 - Increase paper size valeus
 - Prevent db insertion crash on #uid too long
 - New restricted option preventing redirection on aliases to canonical
 - New restricted option to inject nginx configuration snippets into site stanza
 - Theme switcher (dark/light toggler)

2.516 2021-06-19

 - Display the fail details on compilation failure (#371)
 - Support arbitrary margin in the bookbuilder (#372)
 - Update texlive install script for TeXlive! 2021

2.515 2021-06-05

 - When pulling a remote git, remove symlinks pointing outside the
   tree. This is a security patch against potential symlink-based
   attacks coming from remote repository, tricking the application to
   access files outside the site root. [SECURITY]
 - Serve symlinks if they point inside the tree.
 - New option to toggle the display of latest entries on special pages

2.514 2021-05-23

 - Fix bug with links which URI doesn't understand (reported by anelki
   on the #amusewiki channel)

2.513 2021-05-21

 - Update i18n strings
 - Do not rely on Freenode for the webchat. Instead, make the iframe
   url editable. Nothing by default. The iframe with the webchat
   didn't seem to work anyway.
 - AMW-Meta: Implement OPDS

2.512 2021-04-25

 - Update i18n: el
 - Refresh the shared repo's hook when the site is reconfigured

2.511 2021-04-11

 - Add Greek I18N
 - Do not trigger Xapian suggestions if not enabled (#366)

2.510 2021-04-05

 - Add support for images in the API
 - Add option to keep the layout always fluid
 - Update I18N: RU (thanks to @link2xt)
 - Carry on ETag and X-Robots-Tag when serving static files from nginx

2.509 2021-02-27

 - Return 410 when the text is deleted without a redirection.
 - Add /remote/edit/library/xxx and /remote/edit/special/xxx
   to API

2.508 2021-02-14

 - Support <sc> and <sf> via new Text::Amuse

2.507 2021-01-14

 - Store and display isbn, publisher, series info, copyright info if
   provided by the muse document. These fields are documented and
   display in the generated formats, but were not in the web app.

2.506 2021-01-06

 - Save instructions to compile a format into the site repo under "bin"
 - Add function to check mailing
 - Add new imposition schema duplex2up (2up variant)
 - Make Authen::SASL a requirement (for SMTP)

2.505 2020-12-15

 - Fix an old bug with the amusewiki restart command not killing the
   children.
 - Improve logging for the /git route
 - Improve sorting for revisions page
 - Add pagination to OPDS category routes (and added custom categories)
 - Cache /opds/crawlable which was too slow
 - Updated I18N: PL

2.504 2020-11-05

 - Updated i18n: BG

2.503 2020-11-05

 - Fix support for BG.

2.502 2020-11-05

 - Updated i18n (added BG)

2.501 2020-10-29

 - Fix access permissions to whitelisted IPs to /git and /mirror

2.500 2020-10-28

 - Support file inclusion GH#53

2.459 2020-07-03

 - Store the feed teaser in the Xapian DB to improve Meta output

2.458 2020-06-22

 - Permit multiple addresses in notification GH#346
 - Show fixed categories in listings as labels

2.457 2020-06-18

 - New themes: robotojournal and purplejournal

2.456 2020-06-12

 - Updated i18n: DE, PL, MK
 - New feature: grant read access to private sites, git and mirror via
   IP whitelisting. Feature is accessible via the admin panel and with
   a new script, amusewiki-whitelist-ip

2.455 2020-05-31

 - Updated i18n (added PL)
 - Support the use of a stripped down TeX Live installation (packaged
   as amusewiki-texlive). Now the debian package depends on that OR on
   texlive-full, but this is the supported solution.
 - Update jquery to current 3.5.1
 - Add opt-in to generate a named toc instead of toc1, toc2, etc.
 - Remove modal ToC (which was not working as expected) and replaced
   with navbar dropdown
 - Improved cover handling for mobile

2.454 2020-05-07

 - Fix redundant/harmful pagination on publish/all
 - Update i18n (tr)

2.453 2020-05-01

 - Add /site-admin/users route for site administrators for user
   management. (#340)

2.452 2020-04-18

 - Implement robots.txt override from DB

2.451 2020-04-13

 - Adjustments to tests and migration from amusewiki-cgit service

2.450 2020-04-12

 - Bump ckeditor version. Users are advised to upgrade it with
   ./script/install_js.sh --clean
 - Remove the need for an external service for cgit (#245)
 - Simplify the setup for using the offline editing with git (#336)

2.442 2020-02-25

 - Enable ipv6 ports on nginx
 - Bump dependency on Text::Amuse to bring in the short form of
   section titles
 - Improve messages for git pulling (GH #331 and #332)
 - Add site option no_autoassign_pubdate (GH #330)

2.441 2020-01-17

 - Fix bug with arbitrary pagination size in the pagination widget
   (the current size was not displayed if not a standard one)
 - Fix crash on /opds/search with non-latin1 characters

2.440 2020-01-08

 - Introduce an experimental feature for parent-children relationships
   between texts (GH#208)

2.431 2019-12-23

 - Logging tuning

2.430 2019-12-23

 - Include deferred texts in search results for logged in (GH# 327)
 - Replace cronjob with unit file for nginx reloading on demand (GH#326)
 - Upgrade the encryption of user passwords
 - Refactor the password resetting feature asking (GH#328)

2.420 2019-12-04

 - Refactor the static indexes (GH#325)
 - Keep the custom formats name stable across migrations (GH#321)

2.412 2019-12-01 [SECURITY]

 -  Restrict remote repositories set in the web interface to git/http
    In some configurations with hostile users, having local gits could
    lead to information disclosure of other repositories (setting the
    remote path to a known local git, the merge will not happen, but the
    commit summary would be listed).

2.411 2019-11-29

 - Extend the use of datatables and localize them (GH#324)

2.410 2019-11-28

 - Use datatables.net Javascript for large tables in the admin (users,
   sites and jobs) instead of monolithic tables and/or pagination.
 - Permit the creation of custom category types beside the predefined
   authors/topics (GH#311)
 - Use Text::Unidecode instead of the custom code
 - List and allow to use existing custom formats in the BookBuilder as
   preloaded settings. (GH#320)
 - List and allow to use existing images as cover in the BookBuilder
   (GH#314)
 - Allow custom format selection in the header (GH#310)
 - Add binary attachments to the infobox (GH#309)
 - When a text is not published, redirect it to /console/unpublished
   instead of a 404 for logged in users (GH#316)

To take advantage of the new BookBuilder features with images, you may
want to reindex the site with amusewiki-bootstrap-archive --refresh.
This step is however optional and doesn't prevent the normal
functioning of the sites (you're just not going to see the images as
available on the BookBuilder until you reindex the affected texts).


2.401 2019-11-01

 - Add CLI options to control the jobber polling interval and
   parallelization.

 - Add id attributes where missing in the top bar, for better styling

2.400 2019-10-27

 - Upgraded RU localization (@link2xt)
 - Improved express publishing

2.392 2019-08-23

 - Upgraded HR and IT localization

2.391 2019-08-15

 - Migrate from Protocol::ACME to Net::ACME2 to get Let's Encrypt
   certificate using the new protocol, given that the old one is
   getting sinked soon.
 - New site option: express_publishing. If in effect, the publishing
   procedure is speeded up and if no conflict is found, the text will
   be published right away. This is useful if there are no external
   contributions.
 - Add List-Id to our mails, so clients have a chance to pick it up.
 - Support per-format template files via newest Text::Amuse::Compile

2.390 2019-07-25

 - Added experimental node system. It's accessible to logged in users
   under /node. The basic functionality is there. Probably needs
   refinement with locale-aware sorting. This permits to create
   arbitrary category trees.
 - Added experimental feature for adding binary files like
   video/audio. Available in the configuration panel.

2.331 2019-07-12

 - Handle Pg listening on 5433 instead of 5432 (debian packaging)
 - Fix the query params for the freenode webchat (they moved from
   qwebirc to Kiwi IRC).
 - Symlink system wide fontspec.json if found installed
 - Display the --ttdir argument for muse-compiler.pl

2.330 2019-05-26

 - RSS optimization
 - Improve layout of text creation screen (thanks @link2xt)
 - Remove unneeded js libraries (validate and datepicker)
 - Show CLI arguments for muse-compile on the bookbuilder and custom
   format pages
 - Let search engines ignore the generated formats
 - Do not rely on CDN for amusewiki-branded bootstrap themes
 - Add a couple of new CSS themes which previously didn't compile
 - Add button to clone the custom formats
 - Translations: use site translation for topics, not the global lexicon.
 - Improve handling of images upload errors
 - Install scripts: install TeXlive 2019 and fallback to cpanm if
   carton fails

2.324 2019-03-19

 - Switch to carton for dependencies tracking (@link2xt)
 - Fix bookbuilder bug on centersection/centerchapter
 - Add a layout template slot for copyright/licence notices
 - Update/check/refresh install scripts

2.323 2019-02-17

 - Fix broken forkawesome CSS in static indexes

2.322 2019-02-16

 - Update ru translations (@link2xt)
 - Update Vagrantfile and build system (@link2xt)
 - Show number of pending revisions in the navbar (@link2xt)
 - Notify when a text status changes. This could be noisy.
 - Add PT localization
 - Handle FR formatting
 - Migrate to ForkAwesome instead of FontAwesome (includes new EPUB
   icon)

2.321 2018-11-29

 - Minor release to silence a useless logging.

2.320 2018-11-24

 - Update ru.po, many thanks to @link2xt and @kabanoid
 - Add Vagrantfile for quick hacking setup (@link2xt)
 - Style improvements with Font Awesome (@link2xt)
 - New bookbuilder options (typearea, tolerances)
 - Fixed a couple of accessibility glitches
 - Enhanced search suggestions
 - Live job monitor (for root users)
 - Fix redundant job scheduling in some corner cases


2.311 2018-10-27

 - Fix encoding of Git::Wrapper output.
 - Update ru.po (@link2xt)

2.310 2018-10-21

 - Fix the "title" table to work nice when MySQL is in strict mode,
   permitting NULLs and removing the default value. Tests pass. We
   already populate those values in code.
 - Log the output of create-doc-site, so if buried, the user can
   inspect it.

2.300 2018-09-22

 - Replace GraphicsMagick with Imager module
 - Add category manager page (can set some author/topic to inactive,
   hiding it)
 - Add a simple JS RSS aggregator
 - Add autocomplete on the layout search box
 - Add spelling corrections on search
 - Add the apple-touch-icon (using the opengraph.png file)

The Imager module requires system libraries to be installed properly.
There is a check on startup to assert you're covered. Otherwise refer
to https://metacpan.org/pod/distribution/Imager/lib/Imager/Install.pod
if in doubt.


2.226 2018-08-16

 - Expose the legacy links via /api/legacy-links (#205)
 - Show the git log when pulling (#207)

2.225 2018-07-29

 - Improve category sorting (take numbers in account)

2.224 2018-07-28

 - Dependencies bump with RTL support in the parser
 - Update the wordpress import script

2.223 2018-07-20

 - New Bookbuilder/custom format options: centerchapter, centersection,
   continuefootnotes
 - Respect the default sorting setting in static indexes

2.222 2018-07-04

 - Add Bahasa Indonesia support
 - AMW-Meta: RSS feeds, avoid use of the DB
 - Mirror script: port to perl and drammatical speed up

2.221 2018-06-10

 - Add nl translations

2.220 2018-05-13

 - Add empty tr language
 - Add new imposition schema: 2x4x1 (via upgraded PDF::Imposition)
 - Provide a disabled and not yet documented application to provide
   an aggregated search of a given set of amusewiki sites residing on
   the same server

2.210 2018-05-03

 - Various fixes and optimizations on mirror routes and Xapian

2.203 2018-04-23

 - Bump dependency on Text::Amuse 1.10 with improved anchors and
   restored compatibility with Emacs Muse
 - Improve anchor display on editing and preview

2.202 2018-03-31

 - Bump dependency on Text::Amuse 1.01 and Text::Amuse::Compile 1.04
 - Do not list ignored files in /mirror.txt
 - Debian: install a disabled fontconfig setting for woff fonts
 - Optimize static indexes
 - Use option restrict_mirror to disable mirroring
 - Update ru i18n (thanks @labdsf)

2.201 2018-03-27

 - Bump dependency on Text::Amuse 1.00 and Text::Amuse::Compile 1.03
 - Fix secondary footnotes CSS

With Text::Amuse::Compile 1.03, a relatively recent bigfoot.sty
version is needed. If your installation is missing it (notably jessie,
stretch is fine), you can install it as the user running the amusewiki
instance with the following commands:

   $ cd /tmp/
   $ mkdir -p `kpsewhich -var-value TEXMFHOME`/tex/latex/bigfoot
   $ wget http://mirrors.ctan.org/macros/latex/contrib/bigfoot.zip
   $ unzip bigfoot.zip
   $ cd bigfoot
   $ make
   $ mv *.sty `kpsewhich -var-value TEXMFHOME`/tex/latex/bigfoot
   $ texhash `kpsewhich -var-value TEXMFHOME`

2.200 2018-03-20

 - Refactored the search page, using facets now
 - Updated ru (thanks @labdsf), it and hr translations, add cs
   preliminary support
 - serve a list of urls to mirror under /mirror.txt and /mirror.ts.txt
   to feed wget with it. Plus provided a client in
   script/mirror-site.sh

This version brings a refactored, faceted search page. To get the
facets working, you need a Search::Xapian module newer then 1.2.22.0.
Notably, Debian jessie has a 1.2.19.0. Another problem is that the
current 1.2.25.0 version on CPAN fails to install using Xapian system
libraries in the 1.2 branch (I believe the issue, a single test
failing, will be addressed in the next Search::Xapian release).

Please note that without satisfying this dependency, Amusewiki will
still work without problems. You are just going to miss a nice
feature.

There are 4 cases here:

 - Debian stretch, Amusewiki installed with deb package: works out of
   the box.

 - Recent distro, with Xapian (system library) > 1.4, and Amusewiki
   installed from git. It could already work out of the box. If not
   so, upgrading Search::Xapian from CPAN (e.g. `cpanm Search::Xapian`)
   will do.

 - Older distro (with Xapian system library 1.2) and Amusewiki
   installed with git: you need to install Search::Xapian from CPAN.
   If it refuses to install because of a single test failing, force
   the installation skipping the tests `cpanm -f Search::Xapian`. I
   asked the upstream, and they confirmed it's harmless.

 - Debian jessie, Amusewiki installed with deb package: you need to
   build a recent Search::Xapian. You can install it from CPAN
   system-wide, but it has the downside of making your system dirty,
   so it's not recommended. Instead, you could build a deb package
   with this procedure (the libsearch-xapian-perl sources are provided
   as courtesy for this case, incorporating the needed patch).

   # apt-get install libdevel-leak-perl libtest-pod-perl devscripts \
                     build-essential fakeroot libxapian-dev
   $ git clone https://github.com/melmothx/amusewiki-debian-packages.git
   $ cd amusewiki-debian-packages/libsearch-xapian-perl-1.2.24.0/
   $ debuild -i -us -uc -b

   And install the resulting deb (as root) in the parent directory.

2.102 2018-02-19

 - Minor fix dependencies in debian packages (gs was missing)
 - Added texts sorting by pages
 - Enforce weak etags for files served by the application

2.101 2018-02-10

 - Improved editing UI for image uploads
 - migrate sessions backend from fastmmap to database

The session migration is handled automatically on upgrade. The
procedure has been tested and saves a copy of the current session
storage.

Worst case scenario, your uses will be logged out. If this happens,
please report it ASAP (but shouldn't happen).

2.100 2018-02-03

 - Improved editing UI: batch file upload and ajax preview

2.099 2018-01-27

 - Updated i18n: ru, it, hr
 - Documentation fixes
 - Upgraded Text::Amuse version to interpret <code> as verbatim

This release changes the behaviour of the <code> and =code= tag which
are now verbatim ones.

To ensure some degree of backcompatibility, if <verbatim> is found
inside a tag, a warning is issued.

<code><verbatim>Material</verbatim></code> is also considered as the
same way as =Material=.

2.098 2017-12-29

 - Add BB/CF option start_with_empty_page

2.097 2017-12-29

 - Localization updates: it, hr (complete)

2.096 2017-12-27

 - Localization updates: fr, ru, de
 - Upgrade the Text::Amuse stack, bringing secondary footnotes, ~~ as
   visible nbsp
 - New editing option: show_nbsp
 - New CF/BB options: nobold and secondary_footnotes_alpha

2.095 2017-11-24

 - Adjusted mailing localization and wording (#163 #155). Thanks to
   racke to point that out.
 - Opt-out for teaser and cover in the listings (#170)
 - Minor fix to the layout for search results (#168)
 - Give access to the site's jobs console to admins (#169)
 - Improve customization of navbar links (#167)

Incompatible change: if you used the configuration file to set the
SMTP parameters, you need to upgrade the setup.

You need to set the desired parameter as environment variable (in the
systemd unit file or in the user starting the application). See
https://metacpan.org/pod/Email::Sender::Manual::QuickStart and
https://metacpan.org/pod/Email::Sender::Transport::SMTP for details.

Example:

  $ export EMAIL_SENDER_TRANSPORT=SMTP
  $ export EMAIL_SENDER_TRANSPORT_host=smtp.example.com
  $ export EMAIL_SENDER_TRANSPORT_port=2525


2.094 2017-11-06

 - Adjust the jobber behaviour to be more aggressive but not too much
 - Documentation fixes
 - Tentative fix for debian-specific amusewiki script on restart

2.093 2017-11-04

 - SEO improvements: noindex on generated files, sitelink searchbox,
   allow /search access to robots.

2.092 2017-11-04

 - Fix jobber startup in thumbnail population, preventing thumbnails
   to be fully populated.

2.091 2017-11-04

 - Add /remote/create API route (#158)

2.090 2017-11-03

 - Improve OpenGraph support
 - Add /library/*/embed route suitable for external iframes
 - Adjusted scheduling of job purging (keep bookbuilder files 1 year)
 - Turn PDFs into custom formats (allowing fine-tuning)
 - Turn slow PDF compilations into async and parallelized job

This entry is not much verbose, but the changes are fairly large (with
some chance of new bugs). Notably, the publishing process has been
improved, deferring the PDF generation into a background job. Also,
the standard PDFs are now custom formats, so they can be tuned
individually.

This is supposed to be the first release of the 2.1 series, hence
numbered 2.090 with some room for minor bug-fixing releases before the
official 2.1.

2.032 2017-10-27

 - Add opengraph support (#150)
 - Prevent chrome to complain for XSS when we supposedly know what we
   are doing (#151)

2.031 2017-10-14

 - Provide /mirror, suitable for wget -m. Please note that the route
   is accessible if /git is enable as well (as both expose the repo
   tree). Of course private sites don't expose them to anonymous
   users. (#144)
 - Provide /listing, replacement for /library as title listing and
   use it in the navbars, providing sorting and pagination. (#142)
 - Add text details to search result (#142)

2.030 2017-10-08

 - Updated and corrected I18N strings
 - Completed i18n for it and hr

2.029 2017-10-07

 - Offer a ToC preview on listing (opt-in) (#130)
 - Register UI language per user and set it at login (#137)
 - Accurate (as much as possible) page count in bookbuilder and listing

This upgrade carries a two step DB upgrade (automatically managed)

2.028 2017-09-30

 - Fix sticky teaser field in the db on line removal (minor bugfix)
 - Defer the generation of the static indexes to a low priority job (#134)
 - At startup, check if the fontspec.json files are good (#133)

2.027 2017-09-29

 - Added option to create automatic teasers (opt-in)
 - Optimize all PNG images (thanks @labdsf)

2.026 2017-09-26

 - Escape some invisible chars when doing the diff (#124)
 - Bump dependency on Text::Amuse with syntax improvements
   (lists obeying indexes and footnotes spanning more
   paragraphs)
 - I18N: added ru strings (thanks @labdsf)
 - Improved site exporting
 - Improved static generation (which now is localized and styled and
   comes with some buttons for sorting.

2.025 2017-08-20

 - Add Cormorant Garamond fonts as dependency (packaged)
 - Bumped Text::Amuse::Compile dependency with improved CSS
 - Remove font-size option from EPUB definition

2.024 2017-07-29

 - Add backlinks feature (#118)
 - Improve error handling for the new text form (#119)
 - Add option to turn links without description to vimeo/youtube/gmaps
   into widgets
 - Fix conditional nocoverpage feature brokens since 2.014 (#121)

2.023 2017-06-15

 - Add documentation for installation on CentOS
 - Fixes to installation scripts
 - Add nofinalpage option to BB and custom formats (#117)

2.022 2017-05-23

 - Do not show deferred titles without a teaser if the option if
   enabled. This way we can have more fine tuning about which titles
   can be shown.

2.021 2017-05-21

 - Add full screen editor to editing page
 - Add an opt-in ordering by sku in the category pages (#116)

2.020 2017-05-17

 - [SECURITY FIX] Fix potential HTML injection when external images
   are enabled. This is a real security issue if it's an openwiki and
   if the option is enabled.
 - Fix stemming when searching on multilanguage sites (#105)
 - Fix debian packages with missing dependencies
 - Fix failure on bookbuilder with cropmarks and "generic" papersize
 - Added a way to add captions to attached PDFs
 - Improved handling of thumbnails
 - Improved formatting of galleries (pages with multiple PDFs)
 - Added option to show the previews when the texts are still deferred
 - Routes for job status and download are now more strict and will not
   serve anything if the job belongs to an user.
 - Added json route to serve the raw headers of the muse file
 - Improved category text listing with widget for sorting/page size

2.014 2017-04-18

 - Add a flag icon when there is an internal anchor
 - Support for hidden toc #notoc

2.012 2017-03-26

 - Use thumbnails for listing (#102)
 - Add option to insert the image at the end of the body (#101)
 - Embed PDFs by splitting them in images (#101)
 - Improved PDF attachment layout (#100)

2.011 2017-03-12

 - Improved handling of git pull jobs, which is now a bulk job and
   will not block the jobber longer than the time needed to compile a
   single text.

 - Support for <verbatim> tag to avoid the markup to be interpreted.

 - Reduce the cropmark offset to 1mm (using new PDF::Imposition
   release)

2.010 2017-02-04

 - Show the git history to logged in even if hidden for anon (#94)
 - Define, show and handle custom formats (#92)
 - Fix mixed content on /user/edit (#93)

2.001 2017-01-20

 - Fixed pagination problems when there are lots of texts with the
   same pubdate.

2.000 2016-12-19

 - Translations update
 - Documentation improvement (#91)

1.995 2016-11-25

 - debian packages now get dbconfig-common support (#88)
 - fix eta for bulk jobs
 - make images accessible from any path (#89)

1.993 2016-11-14

 - Add a rebuild action, both for a single text or the whole site (#87)
 - Add metadata to PDF (#86)

1.992 2016-11-05

 - [SECURITY FIX] Fixed directory traversal on /git urls which
   discloses potentially private sites. Only sites with CGIT >= 0.11
   are affected. Older versions (notably the one packaged by debian)
   are not affected.

1.991 2016-11-02

 - Upgraded I18N files (it and hr)

1.990 2016-11-01

 - Implement authorization without redirect #67
 - Permit customization of fonts (globally and per site) #57
 - Replaced font-awesome with glyphicons
 - Added customization for edit screen

The "webfonts" directory is now obsoleted and can be removed. It's
been replaced by the fontspec.json file which should have been created
automatically on restart.

This release is a public beta (but production ready) for AmuseWiki 2.0.

1.923 2016-10-13

 - Added danish i18n
 - Bumped Text::Amuse to avoid failing LaTeX runs when hyperlinks are
   placed in headings

1.922 2016-10-02

 - Bumped Text::Amuse::Compile to get better output on merged files
 - Added pagination, sorting and filtering to /admin/jobs/show

The interface is not stable yet, but works. Needs some real life
testing to be consolidated.

1.921 2016-09-24

 - Fixed headers for cache control
 - Added fine-grained pagination options

1.920 2016-09-11

 - Index each text twice, once with and once without diacritics (xapian)
 - Prevent the maintainer's scripts to run as root
 - Debian package provides a wrapper for root, called amusewiki
 - Save the bookbuilder sessions in the database
 - Implement bookbuilder session resuming by token

If you want to reindex the texts with the new algorithm, please run

 amusewiki-bootstrap-archive --xapian

1.916 2016-08-13

 - I18N updates: es hr mk

1.915 2016-07-30

 - I18N updates: fr, sq

1.914 2016-07-26

 - Internal minor refactoring for JSON serializer
 - Fixed crash (pretty nasty) when the admin set the locale to sr
 - Fixed crash if xapian is out of sync with the db

1.912 2016-07-22

 - Added js to show the footnotes in the text

1.911 2016-07-22

 - Added albanian support
 - New fonts dimensions in the bookbuilder: 13 and 14pt
 - New bookbuilder option: unbranded PDF

1.910 2016-07-18

 - Fixed pagination sorting with same date
 - Enlarged fields in the creation page
 - Added localized /help/faq from documentation
 - Added /help/irc with livechat for users which can edit the pages
   (by default, points to #amusewiki on freenode).
 - I18N update: es, it, hr
 - Make the pagination configurable (GH #62)
 - Move the infobox to the bottom only if configured so for blog-styled
 - Editing page: various layout fixes (uses ajax for speedup) (GH #60)
 - Handle the unicode exceptions grafully (it was spamming errors on bad requests) (GH #65)
 - Added meta description to categories and texts (GH #58)
 - Added option to turn links to images into actual images (GH #53)
 - Tested and adjusted custom template support (GH #64)
 - Added profiles for BB (GH #61) (experimental, but working, probably
   will need some adjustments)

This version brings a DB upgrade, which is managed automatically by
the init script.

1.906 2016-07-06

 - Fixed pagination ordering when pubdate is exaclty the same (+ tests)

1.905 2016-07-06

 - Fixed bug on pagination where pubdate is always the same (unclear if affecting
   only Pg or it's a wider issue). Hotfix.

1.904 2016-07-04

 - Added documentation for FreeBSD (and tested on this OS)
 - Fixed some portability issues in the helper scripts

1.903 2016-07-01

 - Fixed crash on site creation with debian package (#56)

1.902 2016-06-28

 - Minor optimization and layout fixes
 - Added teaser, image and thumbnails to the OPDS entries
 - Serve thumbnails with XSendfile if available

This change, even if minor, require an update to the webserver
configuration, so be sure to execute
script/amusewiki-generate-nginx-conf and follow the instructions.

1.901 2016-06-27

 - Paginate the listing of texts under categories and add breadcrumbs there
 - Added next/prev links in the head when paginating the results (SEO)
 - Hide pubdates from category items when not in blog style mode

1.900 2016-06-25

 - New blog mode, which can be activated in the admin console, per
   site. The blog mode changes the behaviour of the site giving it a
   time-centric display of texts.
 - Flexible tag cloud which can be embedded via ajax
 - Free form HTML layout elements (top, bottom, left, right)
 - Support for teasers and decorative images
 - Monthly archives which can be embedded via ajax
 - Legacy links support
 - Revamped and reorganized admin console
 - Attached images preview in the edit screen
 - Selectable CSS themes
 - Wordpress import script
 - Minor layout adjustments

Please note that due to changes of the layout, you're going to suffer
some downtime during the upgrade (hence the major version bump). There
is a set of database changes, but they are going to be handle
automatically and without surprises.

1.828 2016-06-19

 - Fixed crash on loc() when square brackets are supplied.

1.826 2016-06-12

 - Upgraded localization
 - DB upgrade for future development

1.825 2016-06-12

 - Added warning when the uploading process is not finished yet.
 - Added notification when a new text is created.
 - Updated help on OPDS for private sites.

1.824 2016-05-18

 - Minor adjustments

1.823 2016-05-13

 - More stats tweaking. Register the download action via ajax.

1.822 2016-05-13

 - Fine-tuned stats
 - Added pt localization

1.821 2016-05-10

 - Fixed crash with Pg on stats (#51)
 - Fixed user agent stat collecting

1.820 2016-05-10

 - Added reset password by mail (#48)
 - Added admin role which is able to set most of the site settings (#49)
 - Added experimental popular sorting (#44)
 - Add HTTP auth for robots on private sites (#50)
 - UI improvements (number of texts pending on the bookbuilder)
 - Updated translations: fr, it, hr
 - Updated documentation

1.811 2016-05-01

 - Fixed daily job routine in the jobber script

1.810 2016-05-01

 - Updated localization
 - Tested ACME on live

1.804 2016-04-30

 - Fixed tests

1.803 2016-04-29

 - Plugged Protocol::ACME into the jobber
 - Added debian cronjob
 - Updated documentation
 - DB dump and admin option for Let's Encrypt

This is another beta

1.802 2016-04-29

 - Decoupled mail sending from the application [INTERNAL]
 - Optimized /opds/crawlable
 - Removed simp_le from the stack and use Protocol::ACME instead

If you used to customize the mailer arguments, please update the
configuration as per README.

This is a beta release.

1.801 2016-04-22

 - Added /help/opds to explain what to do with the OPDS link

1.800 2016-04-22

 - Decoupled the localization framework from the application
 - Completed translations: fr and mk.
 - Updated depencencies Text::Amuse and Text::Amuse::Preprocessor

The upgrade should be transparent, but please see LOCALIZATION.txt for
details.

1.704 2016-03-11

 - Added dynamic robots.txt
 - Added sitemap.txt

1.703 2016-03-11

 - Added /opds/search
 - Added /opds/crawlable
 - Fixed footer layout

1.702 2016-03-08

 - Added /latest controller
 - Added opensearch description

1.701 2016-03-06

 - Fixed footer (OPDS was hidden)

1.700 2016-03-06

 - Added OPDS server under /opds

1.606 2016-02-22

 - Completed HR translation. ES, IT and HR are now completed.
 - Minor fixes (GH #39, #40, #41)
 - Adjusted js to work around bootstrap fixed topbar positioning
 - Fixed BB bug with partials and quotas (GH #38)

1.605 2016-02-09

 - Removed the cache for the listing. Optimized sql to compensate.
 - Simplified the logger code.
 - Optimized the static index generator to speed-up publishing.

1.604 2016-02-02

 - Added some documentation

1.603 2016-02-01

  - Minor bugfixes (triggered by different setups)

1.602 2016-01-31

  - Added option to the admin for highlight.js configuration (select
    the languages you are interested in).
  - Fix to avoid jobber's crash when the db connection goes away in
    the wrong moment.

1.601 2016-01-22

  - Optimization for sorting of titles and categories

1.60 2016-01-22

  - Bookbuilder new feature: partial texts (#14)
  - Automated installer (#29)
  - Added javascript code highlighter (#1)
  - Moved cgit refreshing to module and trigger it on conf changes
  - Fixed BB crash when reusing setup with a cover (#30)
  - Fixed missing Xapian purging on deletion by git removal (#31)
  - Added delete button and code for category descriptions (#32)
  - Hold the webserver configuration in a model
  - Added let's encrypt support via simp_le
  - Bookbuilder new feature: running headers
  - Bookbuilder new feature: cropmarks
  - Bookbuilder new feature: custom paper size
  - New imposition schemas in the Bookbuilder
  - Daemon optimization with fork to keep the memory low
  - Prepared sources for debian packaging

Due to scripts renaming, please stop the application *before*
upgrading. Now the end-user scripts have an "amusewiki-" prefix.

Model::CgitProxy is gone and is replaced by Model::Webserver. If you
have in your config a <Model::CgitProxy> stanza with the port, please
replace it with cgit_port in a <Model::Webserver> stanza.

If you want to start using the let's encrypt certificates for SSL,
look at the LET'S ENCRYPT section in the INSTALL.txt document.

1.56 2015-12-02

 - Handle long author names (via bumped up Text::Amuse::Compile)
 - Added headings option to the bookbuilder (buggy, probably impossible to
   fix)
 - Updated i18n files

1.55 2015-12-01

 - Fixed git command for older gits

1.54 2015-12-01

 - Moved the files produced by the bookbuilder into a private directory (#27)
 - Added UI to add remotes to the repo (#18)

1.53 2015-11-23

 - Added option to upload an HTML file instead of pasting the body (#22)
 - Doc fixes (#22)
 - Hide the filters by default (#23)
 - Log user agent and referrer on 404 (#24)
 - Try not to hit the session without a reason (#25)

1.52 2015-10-30

 - Fixed bug due to bad file extension parsing, which was excluding
   some files after a pulling.

1.51 2015-10-30

 - Introduced description lists via new Text::Amuse
 - Introduced production of slides via new Text::Amuse::Compile
 - Slides are supported in the bookbuilder as well (single file)
 - Improved commit versions and crediting in the archive git history
 - Selection of slides themes and colors in the admin
 - Selection of mono and sans fonts in the admin

New fonts were added. To assert that you have all the required fonts
installed and to have the font preview properly working, please
execute:

  cd font-preview
  ./gen.sh

1.41 2015-10-26

 - New logging system: Log::Contextual + Log:Log4perl
 - Avoid useless question on revision selection screen

1.40 2015-10-24

  - Handle DB upgrades automatically (with DeploymentHandler)
  - Check installation on js on startup
  - Documentation fixes  (GH #8)
  - Improved admin revision display (GH #9)
  - List attachments in the revision descriptions (GH #13)
  - Fixed bug with author-related fields (GH #15)

IMPORTANT NOTICE. From this version the code itself is taking care of
dependency upgrades and db upgrades. If you are upgrading from a
version greater or equal to 1.20, there is nothing for you to do,
other than the usual upgrade routine:

 ./init-all.sh stop
 git pull
 ./init-all.sh start

If by chance you are upgrading from an earlier version, please be sure
to apply all the the intermediate sql files in the "sql" directory.


1.35 2015-10-15

 - Updated i18n: spanish
 - Do not validate the commit message on preview (GH #2)
 - New option to trigger the validation on commit message
   (default: enforce, can be set in the admin) (GH #2)
 - Removed from the repo jquery validation, use CDN if not installed
 - Localized the jquery validation messages
 - Fixed script install-cgit.pl
 - Fixed missing translitteration of Ã± (GH #10)
 - Fixed trailing space in footer (GH #12)

The jquery validation scripts are no longer shipped. If not present,
amusewiki will use the CDN, but PLEASE install them locally on upgrade:

 mkdir -p root/static/js/validate
 cd root/static/js/validate
 wget http://jqueryvalidation.org/files/jquery-validation-1.14.0.zip
 unzip jquery-validation-1.14.0.zip

Please reconfigure cgit to pick up the correct paths. Now you're not
required any more to symlink the repo in /var/cache/git if you don't
need the git:// cloning.

 ./script/install-cgit.pl --reconfigure

1.34 2015-08-26

 - Documentation fixes after walk through installation

1.33 2015-08-26

 - Bump up dependency to use EBook::EPUB::Lite
 - Suggest to use quote_names in the db connection settings

If you use postgres, please compare your dbic.yaml with
dbic.yaml.pg.example and add "quote_names: 1" to it.

1.32 2015-08-26

 - Completely removed fcgi_params from cgit nginx setup.
 - Allow the setting of the port for the cgit server (--cgit-port)
 - Allow the setting of the nginx configuration filename (--basename)
 - Moved ckeditor configuration into a route
 - Use CDN for ckeditor if not locally installed.
 - Added methods to serialize and deserialize site configs
 - New script clone-site.pl, for import and export of site configs
   across different instances

The fcgi_params reference was removed from the nginx configuration. If
you want to upgrade, execute:

  script/generate-nginx-conf.pl

And install the generated file as explained in the output (meant to be
cut and pasted as root).


1.31 2015-08-18

 - Refactored the nginx config generator
 - CSS fix for cgit
 - declare the encoding when serving static text files
 - updated translations: de

The new nginx configuration setup has a stanza for each site, to make
room for different SSL certificates. The common configuration was
moved to an included file.

To upgrade the configuration, execute

  script/generate-nginx-conf.pl

And install the generated file as explained in the output (meant to be
cut and pasted as root).

1.30 2015-07-24

 - Integrated cgit into the layout.
 - Optional upgrade to cgit latest release (0.11.2)
 - Unified the installation scripts install-cgit.sh and generate-cgit-repolist.pl
 - Fixed bug in site creation hostname validation

The configuration upgrade can be performed with

 script/install-cgit.pl --reconfigure

If you want to upgrade cgit as well, you can execute the script
without argument.

  script/install-cgit.pl

Notes: install libssl-dev if you're getting the error about missing
openssl/ssl.h during compilation.

Due to the new setup (with cgit listening only to localhost), you need to regenerate the nginx configuration with

  script/generate-nginx-conf.pl > /tmp/amusewiki

Install /tmp/amusewiki in the nginx configuration directory and
reload nginx.

1.25 2015-06-27

 - Layout fix release. No code changes.
 - Upgraded to Bootstrap 3.3.5 (latest), including CSS, JS, Glyphicons
 - Leveraged the glyphicons for the ToC toggler and navbar items
 - Improved navbar responsiveness


1.24 2015-06-20

 - Added polish language support (no translation in for now). For this
   an upgrade of Text::Amuse is required.

 - Before returning a 404 in a catchall route, look at the first
   fragment of the path and lookup texts, categories and aliases for
   the uri, redirecting there if found

1.23 2015-06-07

 - Fixed crash introduced in 1.22.

1.22 2015-06-06

 - Refactored Library controller to avoid ugly ->forward (thanks to mst)
 - Make possible to librarians to list and display deferred texts
 - Updated translations: it

1.21 2015-05-15

 - Added LuaLaTeX option (slow and experimental)

1.20 2015-05-14

 - Changed /topics and /authors to /category/topic/ and /category/author
 - Left permanent redirections in place
 - Added category description
 - Added category description editor (with muse markup)
 - Major bump because of changed paths

You have to apply the incremental script at
sql/AmuseWikiFarm-Schema-1.14-1.20-<your-db>.sql before the server
restart.

1.14 2015-04-30

 - New option to add a HTML snippet to special pages
 - New option to add arbitrary links in the "More" bar

You have to apply the incremental script at
sql/AmuseWikiFarm-Schema-1.05-1.14-<your-db>.sql before the server
restart.

1.12 2015-04-23

 - Added utils/import path to import chunks of HTML
 - Updated po files and italian translation

1.11 2015-04-19

 - Added new option to trigger the paginator in /archive and /archive/<lang>
 - Adjust the paginator according to the locale collation (diacritics)
 - Show the number of thext in /archive and /archive/<lang>

1.10 2015-04-12

This is a bugfix release.

 - Fixed multilang bug when the uri got the language prefix appended
   at each request on /new, so uri already taken generated something
   like uri-it-it-it.
 - Fixed missing category text count update on text deletion.
 - Fixed autocompletion api to return only used categories.

1.09 2015-04-08

 - Upgraded prerequisites to fix some false positives on lists
 - Minor style change in the preamble (from p to div)

1.08 2015-03-22

 - Added private site type, where only users have access.
 - Fixed crash on Xapian stemmer where site language is italian
 - Fixed crash when the supplied lexicon.json is invalid
 - Integrated lexicon.json in the localization plugin
 - Adjusted text's preamble

No DB upgrade needed.

1.07 2015-02-27

 - Fixed leaked template in the static indexes

This is a bug-fixing only release

1.06 2015-02-21

 - Bumped up prerequisites: Text::Amuse::Compile
 - Updated translations: mk
 - Added EPUB output to Bookbuilder
 - Added font embedding option to Bookbuilder's EPUBs
 - Added user administration (only for root users)

There is no DB upgrade, but to get the font embedding working you need
to populate the "webfonts" directory. To do so:

  cd webfonts
  ./populate-webfonts.pl

If you have the fonts installed and the fc-list output is parsable,
you should see the directory full of fonts. The space (ab)used with
these copies is about 32Mb (if you can't have 50Mb spare, better you
don't run this application at all).

1.05 2015-02-07

 - Bumped up prerequisites: Text::Amuse, Text::Amuse::Compile,
   PDF::Imposition
 - Added "opening" option to the site options.
 - Updated translations: it, hr.
 - Safe old revision (published) and job (completed) purging.
   Revisions and jobs older than 1 month will get be purged from the
   database and the associated files removed. Of course, this doesn't
   mean that the texts themselves are removed, just the revision.

This change is minor but requires a db upgrade. You have to apply the
incremental script at sql/AmuseWikiFarm-Schema-1.02-1.05-<your-db>.sql
before the server restart.

1.04 2015-01-08

 - Updated translations: ru, mk
 - Job page will show the queue, if any
 - Fixed bug with category's names being stuck on the first-come

No DB or dependencies upgrade required.

1.03 2014-12-07

 - Added 4UP imposition schema to the bookbuilder. The prerequisite of
   PDF::Imposition has been bumped up.
 - Bumped up Text::Amuse to fix a crash in some corner case with weird markup.
 - Added 9pt to the bookbuilder options.
 - The current running version is now shown as an empty file in the app dir.
 - Display the current cover image in the bookbuilder, if any.
 - Added sorting to topics and authors pages.
 - Extended the check on cross-site sessions. As a side effect, the
   logs should not be spammed anymore by dumb messages about session
   deletions because of UA mismatch.

If you use nginx, this upgrade requires a change in the ngnix
configuration. You can run again the script/generate-nginx-conf.pl and
check the differences produced. If you prefer the manual way, add this
stanza in the amusewiki server { } stanza:

    location /private/bbfiles/ {
        internal;
        # the following should be the actual path
        alias /home/amuse/amusewiki/bbfiles/;
    }

Modules to upgrade via CPAN: Text::Amuse and PDF::Imposition. Running
perl Makefile.PL will check if you got the correct versions.

1.02 2014-11-26

This release add Sans fonts support. To regenerate the preview (and
check that all the fonts are in place), you have to rerun the script
gen.sh in the font-preview directory:

 cd font-preview
 ./gen.sh

This release also add a new table to the database. Please run the sql
script sql/AmuseWikiFarm-Schema-0.998-1.02-XXXX.sql for your database
before the server restart.

Change list:

 - Added swedish translations
 - Added sans fonts
 - Improved language setting (html header and new texts) for multilanguage
 - Added options table
 - Added option for number of RSS and latest entry menu
 - Added toggler for cover upload's options

1.01 2014-11-20

This version bumps up the prerequisites Text::Amuse and
Text::Amuse::Preprocessor, which have to be upgraded.

There are no database schema changes.

 - Added swedish support
 - Fixed js diff script
 - Fixed bug with URIs overflowing because of multichar replacements
 - Require (client-side only) a username for anonymous commits
 - Updated schema images
 - Added a command-line fetcher to keep different sites synced

1.00 2014-10-22

 - Fist stable (or kind of stable) release
